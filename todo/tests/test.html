<!DOCTYPE html>
<html lang="en">
  <head>
    <link rel="stylesheet" href="../../../dijit/themes/claro/claro.css" />
    <meta charset="utf-8">
    <title>Todo component test</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="">
    <meta name="author" content="SK">

  </head>

<body class="claro">
	<div id="todoEditor"></div>
    <div id="todoEditor2"></div>
    <script data-dojo-config="async: false"
        src="../../../dojo/dojo.js">
    </script>

    <script>
		require([
			'dojo/Stateful',
			'sktodos/todo/TodoEditor',
            "SkFramework/utils/statefulSync",
            'skTodos/model/domain/Todo',

		], function(Stateful, TodoEditor, statefulSync, Todo){
			window.externalModel = new Todo({label: "Faire les courses"});

			var todoEditor = window.todoEditor = new TodoEditor({
                value: externalModel,
            });
            todoEditor.placeAt("todoEditor");

            var todoEditor2 = window.todoEditor2 = new TodoEditor({
                value: externalModel,
            });
            todoEditor2.placeAt("todoEditor2");

            console.assert(externalModel===todoEditor.get("value") , "If we set a Todo instance on todoEditor, it does not create a new one");

            console.assert(todoEditor.get("label") === todoEditor._components.labelWidget.get("value"), "The internal model has the same label than the label widget");
            //trying to change label on todo model
            todoEditor.get("value").set("label", "test");
            console.assert(todoEditor.get("label") === "test");
            console.assert(todoEditor._components.labelWidget.get("value") === "test");

            //trying to change label on todoEditor
            todoEditor.set("label", "truc");
            console.assert(todoEditor.get("value").get("label") === "truc");
            console.assert(todoEditor._components.labelWidget.get("value") === "truc");

            console.assert(todoEditor.get("checked") === false, "The internal model 'checked' property is false by default");

            todoEditor.set("checked", true);
            console.assert(todoEditor._components.checkWidget.get("checked") === true, "When updating the internal model, the component is updated");
            console.assert(todoEditor._components.labelWidget.get("disabled") === true, "When updating the internal model, the component is updated");
            try {
                todoEditor.set("label", "Faire la lessive");
            }
            catch(err){
                console.assert(err, "We cannot change the label of an already compelted task");
            }

            todoEditor._components.checkWidget.set("checked", false);
            console.assert(todoEditor.get("checked") === false, "When updating the component, the internal model is updated");

            //TODO: test setting "disabled" to true then to false and see if checkWidget value is aletered


		});
	</script>
</body>
</html>